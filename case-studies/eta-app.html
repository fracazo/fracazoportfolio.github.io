<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Reducing Friction in Government Visa Applications - Alex Fracazo</title>
  <meta content="Automating data entry to improve completion and reduce user effort in a high-stakes service." name="description">
  <meta content="Reducing Friction in Government Visa Applications - Alex Fracazo" property="og:title">
  <meta content="Automating data entry to improve completion and reduce user effort in a high-stakes service." property="og:description">
  <meta content="../images/opengraph.jpg" property="og:image">
  <meta content="Reducing Friction in Government Visa Applications - Alex Fracazo" property="twitter:title">
  <meta content="Automating data entry to improve completion and reduce user effort in a high-stakes service." property="twitter:description">
  <meta content="../images/opengraph.jpg" property="twitter:image">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="../images/favicon.svg" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.svg" rel="apple-touch-icon">

  <!-- Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="../css/styles.css" rel="stylesheet">
</head>
<body>
  <!-- Mobile Menu Button -->
  <button class="hamburger" aria-label="Toggle menu">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
      <path d="M5 8H19"/>
      <path d="M5 16H19"/>
    </svg>
  </button>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Sidebar">
      <div class="sidebar-header">
        <a href="../index.html" class="brand" aria-label="Home">
          <span>Alex Fracazo</span>
        </a>
        <button class="sidebar-close" aria-label="Close menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
      <nav class="case-study-nav" aria-label="Case study navigation">
        <a href="../work.html" class="back-link">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="m12 19-7-7 7-7"/></svg>
          Back to Work
        </a>
        <div class="case-nav-title">
          <h2>On this page</h2>
        </div>
        <ul class="toc-list"></ul>
      </nav>
      <div class="sidebar-actions">
        <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">
          <span class="theme-tooltip theme-tooltip-light" aria-hidden="true">Switch to light mode</span>
          <span class="theme-tooltip theme-tooltip-dark" aria-hidden="true">Switch to dark mode</span>
          <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2"></path>
            <path d="M12 20v2"></path>
            <path d="m4.93 4.93 1.41 1.41"></path>
            <path d="m17.66 17.66 1.41 1.41"></path>
            <path d="M2 12h2"></path>
            <path d="M20 12h2"></path>
            <path d="m6.34 17.66-1.41 1.41"></path>
            <path d="m19.07 4.93-1.41 1.41"></path>
          </svg>
          <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
          </svg>
        </button>
      </div>
    </aside>
    <div class="sidebar-backdrop"></div>

    <!-- Main content -->
    <main id="content" role="main">
      <section class="section case-study-content">
        <div class="case-study-main">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="../index.html">Home</a><span class="breadcrumb-sep"> &gt; </span><a href="../work.html">Work</a><span class="breadcrumb-sep"> &gt; </span><span>ETA App</span>
        </nav>
        <header class="case-header">
          <h1 class="case-title">Reducing Friction in Government Visa Applications</h1>
          <div class="case-metadata-card">
            <img src="../images/62dc274f132cbe543717e126_work1-p-2000.jpg" alt="ETA App" class="case-hero-image">
            <div class="metadata-content">
              <div class="metadata-item">
                <svg class="metadata-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M6 3.75A2.75 2.75 0 0 1 8.75 1h2.5A2.75 2.75 0 0 1 14 3.75v.443c.572.055 1.14.122 1.706.2C17.053 4.582 18 5.75 18 7.07v3.469c0 1.126-.694 2.191-1.83 2.54-1.952.599-4.024.921-6.17.921s-4.219-.322-6.17-.921C2.694 12.73 2 11.665 2 10.539V7.07c0-1.321.947-2.489 2.294-2.676A41.047 41.047 0 0 1 6 4.193V3.75Zm6.5 0v.325a41.622 41.622 0 0 0-5 0V3.75c0-.69.56-1.25 1.25-1.25h2.5c.69 0 1.25.56 1.25 1.25ZM10 10a1 1 0 0 0-1 1v.01a1 1 0 0 0 1 1h.01a1 1 0 0 0 1-1V11a1 1 0 0 0-1-1H10Z" clip-rule="evenodd"/><path d="M3 15.055v-.684c.126.053.255.1.39.142 2.092.642 4.313.987 6.61.987 2.297 0 4.518-.345 6.61-.987.135-.041.264-.089.39-.142v.684c0 1.347-.985 2.53-2.363 2.686a41.454 41.454 0 0 1-9.274 0C3.985 17.585 3 16.402 3 15.055Z"/></svg>
                <div class="metadata-text">
                  <p class="metadata-label">Product</p>
                  <p class="metadata-value">Electronic Travel Authority App</p>
                </div>
              </div>
              <div class="metadata-item">
                <svg class="metadata-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M2 4.25A2.25 2.25 0 0 1 4.25 2h11.5A2.25 2.25 0 0 1 18 4.25v8.5A2.25 2.25 0 0 1 15.75 15h-3.105a3.501 3.501 0 0 0 1.1 1.677A.75.75 0 0 1 13.26 18H6.74a.75.75 0 0 1-.484-1.323A3.501 3.501 0 0 0 7.355 15H4.25A2.25 2.25 0 0 1 2 12.75v-8.5Zm1.5 0a.75.75 0 0 1 .75-.75h11.5a.75.75 0 0 1 .75.75v7.5a.75.75 0 0 1-.75.75H4.25a.75.75 0 0 1-.75-.75v-7.5Z" clip-rule="evenodd"/></svg>
                <div class="metadata-text">
                  <p class="metadata-label">Platform</p>
                  <p class="metadata-value">iOS and Android</p>
                </div>
              </div>
              <div class="metadata-item">
                <svg class="metadata-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074.003Z"/></svg>
                <div class="metadata-text">
                  <p class="metadata-label">Role</p>
                  <p class="metadata-value">Lead Product Designer</p>
                </div>
              </div>
              <div class="metadata-item">
                <svg class="metadata-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75Z" clip-rule="evenodd"/></svg>
                <div class="metadata-text">
                  <p class="metadata-label">Year</p>
                  <p class="metadata-value">2020</p>
                </div>
              </div>
            </div>
          </div>
          <p class="case-intro">Automating data entry to improve completion and reduce user effort in a high-stakes service.</p>
        </header>

        <div class="summary-card">
          <h2><img src="../images/bookmark.svg" alt="" width="24"> Summary</h2>
          <p>The Department of Home Affairs was finding it difficult to manage the ETA visa data mismatch, due to the time it took to update the traveller data and interact with airlines/gates.</p>
        </div>

        <div class="case-study-section">
          <h2>Discovery & Research</h2>
          
          <h3>Known Facts</h3>
          <p>An ETA is an electronically stored authority equivalent to an e-visa, which is linked to a passport number.</p>
          <img src="../images/62ca9453bd099acc44edfcac_Screen-Shot-2015-08-23-at-2.02.32-PM.png" alt="Australian Government ETA website">
          <p class="img-caption">Australian Government ETA web-based website</p>
          <p>When the project started, the Department of Home Affairs offered an <strong>ETA product (web-based website)</strong> as the primary entry point for users to apply for the ETA, to facilitate clients <strong>from nominated countries</strong> visiting Australia <strong>for short-term tourist or limited business activities.</strong> The process could take anywhere from a <strong>week to two months</strong>.</p>

          <h3>User Immersion</h3>
          <p>I wanted to meet with those who were significantly involved in the visa approval process the border control and management providers. Therefore, I contacted the key stakeholders in Sydney, SITA and the Department of Home Affairs. I gained access to relevant and high-security data and also interviewed some of their staff. Some data analysed:</p>
          <ul>
            <li>Quantity of ETAs processed</li>
            <li>% of data success rate, and ETAs not completed</li>
            <li>Average % of processing time of ETAs</li>
            <li>Data accuracy recorded from the last year</li>
          </ul>

          <h3>Problem Analysis</h3>
          <p>Before visiting Australia, people need to apply for a visa and manually fill out a multi-page form on the ETA website with the following information:</p>
          <ul>
            <li><strong>Passport</strong> information</li>
            <li><strong>Identity</strong> details</li>
            <li><strong>Personal</strong> information</li>
            <li>Visitor <strong>integrity</strong> information</li>
          </ul>
          <img src="../images/62c93ec16128094ec8c19b4b_Screen-Shot-2022-07-09-at-6.39.18-pm.png" alt="ETA form">

          <h3>Competitive Landscape</h3>
          <p>We also analysed worldwide business trends on e-visas and found out that:</p>
          <blockquote>Malaysia was the first country from APAC to collect biometrics through visa applicants and now expected to have the largest market share in the Asia-Pacific e-visa market.</blockquote>
          <p>Countries that have additional support for e-visas have helped the market share grow in the region.</p>

          <h3>Key Insights</h3>
          <p>The need for smart processes that <strong>eliminate manual entries</strong> and support operators and the demand for flexibility and scalability, are expected to be the key drivers for the future.</p>

          <h2>Defining the Solution</h2>

          <h3>Problem Reframing</h3>
          <p>I took a few steps back and looked at the original challenge again. This time, with much more context to the problem.</p>
          
          <h4>What were we trying to achieve?</h4>
          <p>Improve the quality of data from travellers and improve the application user experience</p>
          
          <h4>Why were we not achieving the goal yet?</h4>
          <p>Traveller data was manually entered in a web-based application</p>
          
          <h4>What could be a solution to the problem?</h4>
          <p>A solution to improve the data quality could be capturing the biometrics and passport chip information using a mobile app to extract the data</p>
          
          <h4>How might we test a solution hypothesis?</h4>
          <p>Implement an external SDK module on a mobile app, where we could test the impact of using the device's capabilities to collect biometrics</p>

          <h3>Problem Statement & Design Prompt</h3>
          <blockquote>The <strong>manual method</strong> of data entry has downstream impacts on the border process as it is susceptible to accidental human error</blockquote>
          <p>Design an improved ETA application experience that will help travellers to Australia apply for an e-visa using their personal device.</p>

          <h3>Business Requirements</h3>
          <ol>
            <li>Reach the desired goal of 100% e-chip biographic and biometric data held on the passport</li>
            <li>A live facial image</li>
            <li>Improve data integrity</li>
            <li>Reduce time spent updating client data</li>
            <li>Reduce time spent interacting with airlines/gates when there is a data mismatch</li>
          </ol>

          <h3>Technical Constraints</h3>
          <h4>SDK technology to scan passports had lots of limitations:</h4>
          <ol>
            <li>No user controls in the interface to lock the camera focus</li>
            <li>No clear feedback on errors</li>
            <li>The user could not choose device orientation</li>
          </ol>

          <h3>User Needs</h3>
          <ul>
            <li>Reduce impacts on the border process</li>
            <li>Meet the need for a fast ETA approval process</li>
            <li>Remove or reduce the manual entry when people are applying for an ETA</li>
          </ul>
          
          <blockquote>The Minimum Viable Product for the ETA mobile app would be the capability to capture the passport data and user biometrics, and also enable users to easily pay for an ETA application using their device.</blockquote>
          
          <h4>Features to be rolled out after the MVP phase</h4>
          <p>The user would be able to add multiple travellers' ETA applications, bucket payments and submissions.</p>

          <h2>Design & Prototyping</h2>

          <h3>Solution Exploration</h3>
          <p>Due to the complexity of the problem, I started sketching some possible solutions and decided to break it down into a few <strong>"How might we"</strong> questions, allowing me to focus on one challenge at a time.</p>
          <blockquote>How might we easily guide the user step by step, to capture user and passport biometrics?</blockquote>
          <blockquote>How might we automatically capture data from the user's passport using the user's personal device?</blockquote>
          <blockquote>How might we design and develop an ETA mobile app to improve the quality of data received from the traveller, capture the biometrics of the applicant and improve the overall user experience in applying for an ETA?</blockquote>
          <img src="../images/62c9751009e7a26955e26495_Screen-Shot-2022-07-09-at-10.30.39-pm.png" alt="Sketches" class="img-small">

          <h4>The goal:</h4>
          <p>Improve the ETA application experience for travellers wanting to visit Australia</p>
          
          <h4>Identified Jobs to be done:</h4>
          <p>Given the ideas that came up in the sketching sessions, I defined which solutions had the most potential to effectively solve the problem and decided to map out a possible main user flow.</p>
          <ol>
            <li>Capture a passport photo</li>
            <li>Scan passport using NFC</li>
            <li>Take a face capture (selfie)</li>
            <li>Confirm Information</li>
            <li>Pay for the ETA</li>
            <li>Submit application</li>
          </ol>

          <h3>User Flows & Wireframing</h3>
          <p>As the solution became increasingly clear, so did the level of detail and fidelity of the artefacts. At this point, I began to explore user flows in more detail, while at the same time considering possible interactions and interfaces.</p>

          <h3>Prototype & User Testing</h3>
          <p>I ran user testing with 8 participants combining early design concepts and the biometrics SDK software we would incorporate in the app. Our primary objective was to identify:</p>
          <ul>
            <li>First impressions of the app</li>
            <li>How it compares to expectations</li>
            <li>How understandable the screens, sequence and questions are</li>
            <li>Perceived ease of use</li>
            <li>Ease of navigation</li>
            <li>Task satisfaction</li>
            <li>Learnability</li>
          </ul>

          <h3>Testing Insights</h3>
          <img src="../images/62ca526de691b2001b6b472a_Screen-Shot-2022-07-10-at-2.15.21-pm.png" alt="User testing results" class="img-small">
          <ul>
            <li>Most of the flow met their expectations</li>
            <li>Some were hesitant about the app and the T&Cs of the app individually</li>
            <li>Reducing the number of permission screens would increase favourability</li>
            <li>Changes to text and descriptions should resolve most misunderstandings</li>
          </ul>

          <h3>Onboarding Flow</h3>
          <p>Due to the legal complexity of collecting private and biometrics data from users, the onboarding and registration process was 5 multi-complex steps where users needed to view, acknowledge and agree.</p>
          <img src="../images/62ca744f6e94d7bd98361a9b_Iterations.png" alt="Iterations">

          <h3>Iteration Process</h3>
          <p>We tried different approaches to reduce the steps from the user side and had approval from the legal team.</p>
          <img src="../images/62caa729b362d1faa50a4f05_idea-1.png" alt="Design idea" class="img-small">
          <p>My approach was to remove the checkboxes and merge the agreements into a single page.</p>
          <img src="../images/62ca9fbbb362d10f340a0a49_iPhone-8---TC.png" alt="Solution implemented" class="img-xs">
          <p class="img-caption">Solution Implemented</p>

          <h3>Design Details</h3>
          <p>The design principles that I focused on most for this project were accessibility and inclusion, as it is an application that people from different cultures and age groups can use. Some of the guidelines I had in mind while creating the user interface were:</p>
          <blockquote>The app provides a utility so the <strong>interface should feel native and simple</strong> to the device the person is using</blockquote>
          <p>The colours used in the design were adapted from the <strong>Home Affairs Brand guidelines to create customer empathy</strong> through the visual and brand connection.</p>
          <p>The preferred typeface from the Brand Guidelines was Helvetica Neue, but since the App is heavy on data, I chose to use the <strong>device's native fonts</strong> to minimise the screen load so that the app feels light weight <strong>as user actions should be quick to respond.</strong></p>
          <img src="../images/62ca98319e6ac4a404da4d49_Screen-Shot-2022-07-10-at-7.13.01-pm.png" alt="Design details" class="img-small">

          <h2>Key Features</h2>

          <h3>Feature Overview</h3>
          <img src="../images/62caa63e33c6504c2ebe850c_Android--iPhone.png" alt="Final results - Android and iPhone">

          <h3>Dashboards</h3>
          <img src="../images/62ca9af337b2819503bdf0e1_Dashboards.png" alt="Dashboards">

          <h3>Capture Passport Photo</h3>
          <p>One of the biggest trade-offs for this project was having to compromise usability. We had to change the design of the passport capture screen to accommodate an SDK interface from an external provider, we were using their service to capture the passport information and process it into data.</p>
          <img src="../images/62caab5eca69f313a9a5b8c5_SDK-Contraints.png" alt="SDK constraints">

          <h3>NFC Scan</h3>
          <img src="../images/62ca9d1c707bc54c532d4461_NFC-Scan.png" alt="NFC Scan">

          <h3>Live Photo Capture</h3>
          <img src="../images/62caac8537b28197abbe90b9_Live-Photo-Capture.png" alt="Live photo capture">
          <img src="../images/62cab1cd6e94d7a4ab3881ba_Confirm-info.png" alt="Confirm info">
          <img src="../images/62cab1e2707bc5d01d2e6328_Payment.png" alt="Payment">
          <img src="../images/62cab1f7ca69f3a06ca60419_Submission.webp" alt="Submission">

          <h3>Copywriting & Microcopy</h3>
          <p>Microcopy played a huge role in product design, many rounds of copy review went into this project. Some guidelines used in the designs and development were related to title style capitalisation.</p>

          <h2>Outcomes & Learnings</h2>

          <h3>Implementation</h3>
          <img src="../images/62cab39b903d34450f12a591_Screen-Shot-2022-07-10-at-9.10.01-pm.webp" alt="Building phase" class="img-small">
          <p>Working with engineers is a big part of my role which I love. For this project, I've used Sketch, Abstract and Zeplin, which work great for syncing files and providing developers with assets.</p>
          <p>Assets were created for <strong>Android and iOS</strong></p>
          
          <h4>Delightful Details</h4>
          <p>There's a user expectation of how these types of UIs operate, so there aren't many opportunities to take a conceptually unique approach. My solution was to design a "standard" step-by-step app that included fun details where possible, such as loading state and user feedback animations.</p>
          <img src="../images/62c94c07a33caa58679afdc3_NFC-Entrant.gif" alt="NFC animation" class="img-small">

          <h3>Key Learnings</h3>
          <ul>
            <li>Using an external SDK provider made our team more agile on deliverables</li>
            <li>I learned how to work with the legal team. I organised multiple showcases and workshops that helped to bring clarity on why we were doing this and how it was aligned with the company's key objectives and unblocked the team</li>
          </ul>

          <h3>Future Improvements</h3>
          <ul>
            <li>Checking analytics to see where users would drop off</li>
            <li>Creating a feature where the user could get help</li>
          </ul>
          
          <p><strong>Additional metrics I would look for</strong></p>
          <ul>
            <li>% time of visa application process</li>
            <li>% of visa applications using the ETA app <strong>compared with</strong> web-based Visa applications</li>
            <li>% of data accuracy reported by the Department of Home Affairs</li>
            <li>% of visa applications via the ETA App</li>
            <li>% of abandoned applications via the ETA App <strong>compared with</strong> web-based Visa applications</li>
          </ul>

          <div class="notice-box">
            <img src="../images/privacy.svg" alt="Privacy">
            <div>
              <p><strong>Protecting Data Privacy</strong></p>
              <p>The case study shows fictitious figures, allowing the necessary contextual information to enable the evaluation of the methodologies used.</p>
            </div>
          </div>
        </div>

        <div class="up-next">
          <h2 class="h2">Up Next</h2>
          <div class="up-next-grid">
            <a href="qantas-entertainment-app.html" class="card-project">
              <div class="image-project">
                <img src="../images/62dc26d29e21732abffdaacd_work4-p-1080.png" alt="Qantas Entertainment">
              </div>
              <div class="content-project">
                <h4 class="h4">Driving Engagement Through a Unified Entertainment Experience</h4>
                <p class="tagline">Reimagining in-flight entertainment as a cohesive product ecosystem.</p>
              </div>
            </a>
            <a href="qantas-app.html" class="card-project">
              <div class="image-project">
                <img src="../images/62dc1d83920df32baae28d6b_work2-p-1080.png" alt="Qantas App">
              </div>
              <div class="content-project">
                <h4 class="h4">Increasing App Adoption by Integrating Entertainment Services</h4>
                <p class="tagline">Using entertainment features to drive a 70% increase in app downloads.</p>
              </div>
            </a>
            <a href="bringing-visibility-to-workers-status.html" class="card-project">
              <div class="image-project">
                <img src="../images/62fbf14400d70051caf1b477_hireup-project-p-1080.png" alt="Hireup">
              </div>
              <div class="content-project">
                <h4 class="h4">Changing Booking Behaviour Through Worker Status Visibility</h4>
                <p class="tagline">Reducing uncertainty in a two-sided marketplace and increasing successful bookings by 12%.</p>
              </div>
            </a>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <section class="section" aria-labelledby="footer-title">
        <footer role="contentinfo">
          <div class="footer-inner">
            <p id="footer-title" class="text footer-location">Based in Australia. Working globally.</p>
            <p class="text footer-links">
              You can find me on <a href="http://www.linkedin.com/in/fracazo" target="_blank">LinkedIn</a>, <a href="https://gitlab.com/afracazo" target="_blank">GitLab</a>, or <a href="contact.html">reach me by email</a>.
            </p>
          </div>
        </footer>
      </section>
    </main>
  </div>

    <!-- Dyslexia-friendly reading (case study only, session-only) -->
    <button id="dyslexia-fab" class="dyslexia-fab">
      <span class="dyslexia-fab-icon">Aa</span>
      <span class="dyslexia-tooltip">Dyslexic friendly</span>
    </button>

  <script>
  // ===========================
  // Theme: default dark + toggle with persistence
  // ===========================
  (function() {
    const KEY = 'theme';
    const root = document.documentElement;
    const saved = localStorage.getItem(KEY);
    const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
    const initial = saved ? saved : (prefersLight ? 'light' : 'dark');
    applyTheme(initial);

    function applyTheme(mode) {
      root.classList.toggle('light', mode === 'light');
      localStorage.setItem(KEY, mode);
    }

    function toggleTheme() {
      const isLight = root.classList.contains('light');
      applyTheme(isLight ? 'dark' : 'light');
    }

    const toggleBtn = document.getElementById('theme-toggle');
    if (toggleBtn) toggleBtn.addEventListener('click', toggleTheme);
  })();

  // ===========================
  // Dyslexia FAB (session-only, no persistence)
  // ===========================
  (function() {
    const root = document.documentElement;
    const btn = document.getElementById('dyslexia-fab');
    if (!btn) return;
    function updateActive() {
      btn.classList.toggle('active', root.classList.contains('dyslexia-mode'));
      btn.setAttribute('aria-pressed', root.classList.contains('dyslexia-mode'));
    }
    btn.addEventListener('click', function() {
      root.classList.toggle('dyslexia-mode');
      updateActive();
    });
    updateActive();
  })();

  // ===========================
  // Mobile Sidebar Toggle
  // ===========================
  (function() {
    const hamburger = document.querySelector('.hamburger');
    const closeBtn = document.querySelector('.sidebar-close');
    const backdrop = document.querySelector('.sidebar-backdrop');
    
    function openSidebar() {
      document.body.classList.add('sidebar-open');
    }
    
    function closeSidebar() {
      document.body.classList.remove('sidebar-open');
    }
    
    if (hamburger) hamburger.addEventListener('click', openSidebar);
    if (closeBtn) closeBtn.addEventListener('click', closeSidebar);
    if (backdrop) backdrop.addEventListener('click', closeSidebar);
    
    // Close sidebar on nav link click (mobile)
    document.querySelectorAll('.sidebar .case-study-nav a, .sidebar .back-link').forEach(link => {
      link.addEventListener('click', closeSidebar);
    });
  })();

  // ===========================
  // Table of Contents (sidebar, case study pages)
  // ===========================
  (function() {
    const tocList = document.querySelector('.case-study-nav .toc-list');
    if (!tocList) return;

    const content = document.querySelector('.case-study-content');
    if (!content) return;
    const headings = content.querySelectorAll('.summary-card h2, .case-study-section h2, .up-next h2');
    if (headings.length === 0) return;

    const seen = {};
    function slugify(text) {
      const raw = text.replace(/<[^>]+>/g, '').trim().toLowerCase()
        .replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-');
      const id = seen[raw] ? raw + '-' + (++seen[raw]) : (seen[raw] = 1, raw);
      return id;
    }

    headings.forEach(function(h) {
      const id = h.id || slugify(h.textContent);
      if (!h.id) h.id = id;
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + id;
      a.className = 'toc-link';
      a.textContent = h.textContent.replace(/\s*\[.*?\]\s*/g, '').trim();
      a.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
        history.pushState(null, null, '#' + id);
      });
      li.appendChild(a);
      tocList.appendChild(li);
    });

    const links = tocList.querySelectorAll('.toc-link');
    const io = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (!entry.isIntersecting) return;
        const id = entry.target.id;
        links.forEach(function(a) {
          a.classList.toggle('active', a.getAttribute('href') === '#' + id);
        });
      });
    }, { rootMargin: '-100px 0px -80% 0px', threshold: 0 });
    headings.forEach(function(h) { io.observe(h); });
  })();
  </script>

</body>
</html>
